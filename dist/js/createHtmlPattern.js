"use strict";function toggleSearchTab(e){$(".showSearch>li").removeClass("active"),$(e).addClass("active")}function queryAndWrite(e,n,t,a){return e.find().then(function(e){if(e.length){var s=[];e.forEach(function(e){var n=e.attributes;n.id=e.id,s.push(n)}),writeSong(s,t,n)}else{var r='<div class="prompt">'+a+"<div>";$(t).html(r)}},function(e){console.log(e)})}function queryWhat(e,n,t){return t=t||"Song",new AV.Query(t).contains(e,n)}function createHtmlPattern(e){return e?'\n                <a href="./song.html?id={{id}}" class="scaleBorder songInfo-container">\n                    <div class="order">{{order}}</div>\n                    <div class="songInfo">\n                        <h3 class="songName">{{songName}} <span>{{quote}}</span></h3>\n                        <p class="singerAlbum">\n                            <svg class="icon {{sq}}" aria-hidden="true">\n                                <use xlink:href="#icon-sq"></use>\n                            </svg>\n                            <span class="singer">{{singer}}{{album}}</span>\n                        </p>\n                    </div>\n                    <div class="playButton">\n                        <svg class="icon" aria-hidden="false">\n                            <use xlink:href="#icon-play"></use>\n                        </svg>\n                    </div>\n                    </a> ':'<a href="./song.html?id={{id}}" class="scaleBorder songInfo-container">\n                    <div class="songInfo">\n                        <h3 class="songName">{{songName}} <span>{{quote}}</span></h3>\n                        <p class="singerAlbum">\n                            <svg class="icon {{sq}}" aria-hidden="true">\n                                <use xlink:href="#icon-sq"></use>\n                            </svg>\n                            <span class="singer">{{singer}}{{album}}</span>\n                        </p>\n                    </div>\n                    <div class="playButton">\n                        <svg class="icon" aria-hidden="false">\n                            <use xlink:href="#icon-play"></use>\n                        </svg>\n                    </div>\n                </a> '}function getPlaylist(e){var n=new AV.Query("Playlist");return n.get(e).then(function(e){var n=e.attributes.content;return window.JSON.parse(n)},function(e){console.log(e)})}function getSongInfo(e){var n=e.playlist,t=e.selector,a=e.html,s=e.callback,r=e.writeOrder,i=[],c=[],o=[];return n.then(function(e){var n=e.length;return e.forEach(function(e,l){var u=new AV.Query("Song"),h=u.startsWith("songId",e+"").find().then(function(e){if(e.length){var o=e[0],u=o.attributes,h=o.id;u.id=h,i[l]=u}c.push(1),c.length===n&&s(i,t,a,r)},function(e){console.log(e),i[l]=null,c.push(1),c.length===n&&s(i,t,a,r)});o.push(h)}),Promise.all(o)},function(e){console.log(e)})}function writeSong(e,n,t,a){var s=$(n);e.forEach(function(e,n){var r=e.songName,i=e.singer,c=e.album,o=e.sq,l=e.id,u=t,h="";if(r.match(/\(.*\)/)&&(h=r.match(/\(.*\)/)[0],r=r.replace(/\(.*\)/,"")),a){var d=n+1;d=d<10?"0"+d:d+"",u=u.replace(/\{\{order}}/g,d)}u=u.replace(/\{\{songName}}/g,r).replace(/\{\{quote}}/g,h).replace(/\{\{singer}}/g,i).replace(/\{\{album}}/g,c).replace(/\{\{sq}}/g,o).replace(/\{\{id}}/g,l),s.append(u)})}function toggleSearchPage(e){$(".showSearch>li").removeClass("active"),$(e).addClass("active")}function triggerEnter(e){var n=jQuery.Event("keypress");n.which=13,e.trigger(n)}!function(e){function n(e){return e?'\n                <a href="./song.html?id={{id}}" class="scaleBorder songInfo-container">\n                    <div class="order">{{order}}</div>\n                    <div class="songInfo">\n                        <h3 class="songName">{{songName}} <span>{{quote}}</span></h3>\n                        <p class="singerAlbum">\n                            <svg class="icon {{sq}}" aria-hidden="true">\n                                <use xlink:href="#icon-sq"></use>\n                            </svg>\n                            <span class="singer">{{singer}}{{album}}</span>\n                        </p>\n                    </div>\n                    <div class="playButton">\n                        <svg class="icon" aria-hidden="false">\n                            <use xlink:href="#icon-play"></use>\n                        </svg>\n                    </div>\n                    </a> ':'<a href="./song.html?id={{id}}" class="scaleBorder songInfo-container">\n                    <div class="songInfo">\n                        <h3 class="songName">{{songName}} <span>{{quote}}</span></h3>\n                        <p class="singerAlbum">\n                            <svg class="icon {{sq}}" aria-hidden="true">\n                                <use xlink:href="#icon-sq"></use>\n                            </svg>\n                            <span class="singer">{{singer}}{{album}}</span>\n                        </p>\n                    </div>\n                    <div class="playButton">\n                        <svg class="icon" aria-hidden="false">\n                            <use xlink:href="#icon-play"></use>\n                        </svg>\n                    </div>\n                </a> '}e.createHtmlPattern=n}(window.app),function(){AV.init({appId:"YQ4yjuFRLMM8TRf2w3pSr3QH-gzGzoHsz",appKey:"oBQKY2jc2MYHDcxLP3QoLxtL"})}(),$(".tabNav>li").on("click",function(e){var n=$(e.currentTarget),t=n.index();n.siblings().removeClass("active").end().addClass("active").parent().parent().find(".tabContent").children().removeClass("active").eq(t).addClass("active")}),$("#searchInput").on("input",function(e){var n=$(e.currentTarget),t=$(".textInput>.textHolder"),a=$(".textInput>.empty"),s=n[0].value;toggleSearchTab(s?".showSearch>.nameResult":".showSearch>.recoSearch"),s?t.text(""):t.text("搜索歌曲、歌手、专辑"),s?a.addClass("active"):a.removeClass("active"),$(".nameResult>h4.scaleBorder>span").text(n[0].value)});var clock;$("#searchInput").on("input",function(e){var n=$(e.currentTarget),t=n[0].value;clock&&window.clearTimeout(clock),clock=setTimeout(function(){if($(".nameResult>.searchList").html(""),t.trim()){var e=new AV.Query("Song");e.contains("songName",t);queryAndWrite(e,'\n                <a href="./song.html?id={{id}}" class="searchItem">\n                    <i class="searchIcon"></i>\n                    <div class="value-container scaleBorder">\n                        <div class="value">{{songName}}</div>\n                    </div>\n                </a>',".nameResult>.searchList","请按回车键查看更多")}},300)}),$(".textInput>.empty").on("click",function(e){var n=$(".textInput>.textHolder"),t=$(".textInput>.empty");$("#searchInput")[0].value=null,n.text("搜索歌曲、歌手、专辑"),t.removeClass("active"),toggleSearchTab(".showSearch>.recoSearch"),$(".nameResult>h4.scaleBorder>span").text("")}),$("#searchInput").on("keypress",function(e){$(".allResult").html("");var n=$("#searchInput").val();if(n.trim()){if(13===(e.which||e.keyCode)){$(".allResult").addClass("loading"),toggleSearchTab(".showSearch>.allResult");var t=queryWhat("songName",n),a=queryWhat("signer",n),s=queryWhat("ablum",n);queryAndWrite(AV.Query.or(t,a,s),createHtmlPattern(),".allResult","暂无搜索结果").then(function(){$(".allResult").removeClass("loading")},function(){$(".allResult").removeClass("loading")});var r='\n            <li class="searchItem">\n                <i class="historyIcon searchIcon"></i>\n                <div class="value-container scaleBorder">\n                    <div class="value">'+n+'</div>\n                    <i class="close"></i>\n                </div>\n            </li>',i=".history>.searchList";0===$(i).children().length?$(i).append(r):$($(".history>.searchList>.searchItem")[0]).before(r)}}}),$(".nameResult>.searchList").on("click",".searchItem",function(e){e.preventDefault(),$(".textInput>.empty").click();var n=$(e.target).closest(".searchItem").attr("href");window.open(n,"_self")}),$(".history>.searchList").on("click",".searchItem",function(e){var n=$(e.currentTarget),t=n.find(".close"),a=n.find(".value").text();$("#searchInput").val(a),$("#searchInput").change();var s=$(".textInput>.textHolder"),r=$(".textInput>.empty");s.text(""),r.addClass("active");var i=jQuery.Event("keypress");i.which=13,$("#searchInput").trigger(i),t.click()}),$(".hotSearchValue>a").on("click",function(e){e.preventDefault(),console.log(1);var n=$(e.currentTarget),t=n.text();$("#searchInput").val(t),$("#searchInput").change();var a=$(".textInput>.textHolder"),s=$(".textInput>.empty");a.text(""),s.addClass("active");var r=jQuery.Event("keypress");r.which=13,$("#searchInput").trigger(r)}),$(".history>.searchList").on("click",".value-container>.close",function(e){e.stopPropagation(),$(e.target).closest(".history>.searchList>.searchItem").remove()});var $recoPlaylist=$(".recoPlaylist"),recommendPlaylist=new AV.Query("RecommendPlaylist");recommendPlaylist.find().then(function(e){e=e.slice(0,6),e.forEach(function(e,n){var t=e.attributes,a=e.id,s=t.title,r=t.poster,i=t.count,c=t.champion,o=$($recoPlaylist[n]),l=new Image;l.src=r;var u=o.find(".count"),h=o.find(".poster>i");$(l).insertBefore(u);var d=o.find("p");o.attr({href:"./playlist.html?id="+a,alt:s}),u.text(i),"true"===c&&h.addClass("champion"),d.text(s)})}).then(function(e){},function(e){console.log(e)}).then(function(){$(".recoPlaylists-container").removeClass("loading")}),function(){getSongInfo({playlist:getPlaylist("59a8f8d8570c35006b1cb153"),html:createHtmlPattern(),selector:".latestMusic",callback:writeSong}).then(function(){$(".latestMusic").removeClass("loading")},function(){$(".latestMusic").removeClass("loading")})}(),function(){getSongInfo({playlist:getPlaylist("59a8f8e01b69e60064127cb7"),html:createHtmlPattern(!0),selector:".songList",callback:writeSong,writeOrder:!0}).then(function(){$(".pageHotList").removeClass("loading")},function(){$(".pageHotList").removeClass("loading")})}(),function(e){e.init({appId:"YQ4yjuFRLMM8TRf2w3pSr3QH-gzGzoHsz",appKey:"oBQKY2jc2MYHDcxLP3QoLxtL"})}(AV),function(e,n,t){function a(n){var t=e(".textInput>.textHolder"),a=e(".textInput>.empty");n?t.text(""):t.text("搜索歌曲、歌手、专辑"),n?a.addClass("active"):a.removeClass("active")}function s(){return'\n                <a href="./song.html?id={{id}}" class="searchItem">\n                    <i class="searchIcon"></i>\n                    <div class="value-container scaleBorder">\n                        <div class="value">{{songName}}</div>\n                    </div>\n                </a>'}function r(e){return new n.Query("Song").contains("songName",e)}function i(n,a,s,r){return n.find().then(function(n){if(n.length){var i=[];n.forEach(function(e){var n=e.attributes;n.id=e.id,i.push(n)}),t.app.writeSong(i,s,a)}else{var c='<div class="prompt">'+r+"<div>";e(s).html(c)}},function(e){console.log(e)})}t.app.changeTextHolderAndEmpty=a,t.app.queryAndWrite=i;var c;e("#searchInput").on("input",function(n){var a=e(n.currentTarget)[0].value;c&&t.clearTimeout(c),c=setTimeout(function(){c=null,e(".nameResult>.searchList").html(""),a.trim()&&i(r(a),s(),".nameResult>.searchList","请按回车键查看更多")},300)}),e("#searchInput").on("input",function(n){var s=e(n.currentTarget)[0].value;a(s),s?t.app.toggleSearchPage(".showSearch>.nameResult"):t.app.toggleSearchPage(".showSearch>.recoSearch"),e(".nameResult>h4.scaleBorder>span").text(s)})}(jQuery,AV,window),function(e,n,t){function a(e){return'\n            <li class="searchItem">\n                <i class="historyIcon searchIcon"></i>\n                <div class="value-container scaleBorder">\n                    <div class="value">'+e+'</div>\n                    <i class="close"></i>\n                </div>\n            </li>'}function s(n){var t=".history>.searchList";0===e(t).children().length?e(t).append(n):e(e(".history>.searchList>.searchItem")[0]).before(n)}function r(e){var t=i("songName",e),a=i("signer",e),s=i("ablum",e);return n.Query.or(t,a,s)}function i(e,t,a){return a=a||"Song",new n.Query(a).contains(e,t)}e("#searchInput").on("keypress",function(n){e(".allResult").html("");var t=e("#searchInput").val();if(t.trim()){if(13===(n.which||n.keyCode)){e(".allResult").addClass("loading"),window.app.toggleSearchPage(".showSearch>.allResult");var i=window.app.createHtmlPattern();window.app.queryAndWrite(r(t),i,".allResult","暂无搜索结果").then(function(){e(".allResult").removeClass("loading")},function(){e(".allResult").removeClass("loading")}),s(a(t))}}})}(jQuery,AV,window.app),function(e,n,t){function a(n,t,a,c){r({playlist:s(n),htmlTemplate:window.app.createHtmlPattern(t),selector:a,callback:i,writeOrder:t}).then(function(){e(c).removeClass("loading")},function(){e(c).removeClass("loading")})}function s(e){return new n.Query("Playlist").get(e).then(function(e){return window.JSON.parse(e.attributes.content)},function(e){console.log(e)})}function r(e){function t(e){function t(e,n){if(e.length){var t=e[0],a=t.attributes,h=t.id;a.id=h,l[n]=a}u.push(1),u.length===s&&c(l,r,i,o)}function a(e,n){console.log(e),l[n]=null,u.push(1),u.length===s&&c(l,r,i,o)}var s=e.length;return e.forEach(function(e,s){var r=new n.Query("Song"),i=r.startsWith("songId",e+"").find().then(function(e){t(e,s)},function(e){a(e,s)});h.push(i)}),Promise.all(h)}function a(e){console.log(e)}var s=e.playlist,r=e.selector,i=e.htmlTemplate,c=e.callback,o=e.writeOrder,l=[],u=[],h=[];return s.then(t,a)}function i(n,t,a,s){var r=e(t);n.forEach(function(e,n){r.append(c(e,n,a,s))})}function c(e,n,t,a){var s=e.songName,r=e.singer,i=e.album,c=e.sq,o=e.id,l=t,u="";if(s.match(/\(.*\)/)&&(u=s.match(/\(.*\)/)[0],s=s.replace(/\(.*\)/,"")),a){var h=n+1;h=h<10?"0"+h:h+"",l=l.replace(/\{\{order}}/g,h)}return l.replace(/\{\{songName}}/g,s).replace(/\{\{quote}}/g,u).replace(/\{\{singer}}/g,r).replace(/\{\{album}}/g,i).replace(/\{\{sq}}/g,c).replace(/\{\{id}}/g,o)}window.app.loadSonglist=a,t.writeSong=i}(jQuery,AV,window.app),window.app.toggleSearchPage=toggleSearchPage,$(".tabNav>li").on("click",function(e){var n=$(e.currentTarget),t=n.index();n.siblings().removeClass("active").end().addClass("active").parent().parent().find(".tabContent").children().removeClass("active").eq(t).addClass("active")}),$(".hotSearchValue>a").on("click",function(e){e.preventDefault();var n=$(e.currentTarget),t=n.text();$("#searchInput").val(t),window.app.changeTextHolderAndEmpty(t),triggerEnter($("#searchInput"))}),$(".textInput>.empty").on("click",function(e){var n=$(".textInput>.textHolder"),t=$(".textInput>.empty");$("#searchInput")[0].value=null,n.text("搜索歌曲、歌手、专辑"),t.removeClass("active"),window.app.toggleSearchPage(".showSearch>.recoSearch"),$(".nameResult>h4.scaleBorder>span").text("")}),$(".nameResult>.searchList").on("click",".searchItem",function(e){e.preventDefault(),$(".textInput>.empty").click();var n=$(e.target).closest(".searchItem").attr("href");window.open(n,"_self")}),$(".history>.searchList").on("click",".searchItem",function(e){var n=$(e.currentTarget),t=n.find(".close"),a=n.find(".value").text();$("#searchInput").val(a),$("#searchInput").change();var s=$(".textInput>.textHolder"),r=$(".textInput>.empty");s.text(""),r.addClass("active");var i=jQuery.Event("keypress");i.which=13,$("#searchInput").trigger(i),t.click()}),$(".history>.searchList").on("click",".value-container>.close",function(e){e.stopPropagation(),$(e.target).closest(".history>.searchList>.searchItem").remove()}),window.app.loadSonglist("59a8f8d8570c35006b1cb153",!1,".latestMusic",".latestMusic"),window.app.loadSonglist("59a8f8e01b69e60064127cb7",!0,".songList",".pageHotList"),function(e,n){function t(){a("RecommendPlaylist").then(function(e){e=e.slice(0,6),s(e)}).then(c,o)}function a(e){return new n.Query(e).find()}function s(n){var t=e(".recoPlaylist");n.forEach(function(n,a){var s=e(t[a]);s.attr({href:"./playlist.html?id="+n.id,alt:n.attributes.title}),r(s.find(".count"),n.attributes.poster),i(s,n)})}function r(n,t){var a=new Image;a.src=t,e(a).insertBefore(n)}function i(e,n){var t=n.attributes,a=t.title,s=t.count,r=t.champion,i=e.find(".count"),c=e.find(".poster>i"),o=e.find("p");i.text(s),"true"===r&&c.addClass("champion"),o.text(a)}function c(){e(".recoPlaylists-container").removeClass("loading")}function o(e){console.log(e)}t()}(jQuery,AV);